YUI.add("hermes-template-search-autosuggest-list-item",(function(n,l){var e=n.Template.Handlebars.revive({1:function(n,l,e,t,a){return" header"},3:function(n,l,e,t,a){return" empty"},5:function(n,l,e,t,a){var r,o,i=null!=l?l:n.nullContext||{},u=n.hooks.helperMissing,s="function",c=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return" autosuggest-selectable-item"+(null!=(r=p(e,"if").call(i,null!=l?p(l,"selected"):l,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:121},end:{line:1,column:153}}}))?r:"")+'" data-track="autosuggestNavigate_'+c(typeof(o=null!=(o=p(e,"rapidType")||(null!=l?p(l,"rapidType"):l))?o:u)===s?o.call(i,{name:"rapidType",hash:{},data:a,loc:{start:{line:1,column:187},end:{line:1,column:200}}}):o)+'" data-href="'+c(typeof(o=null!=(o=p(e,"url")||(null!=l?p(l,"url"):l))?o:u)===s?o.call(i,{name:"url",hash:{},data:a,loc:{start:{line:1,column:213},end:{line:1,column:220}}}):o)+'"'+(null!=(r=p(e,"if").call(i,null!=l?p(l,"title"):l,{name:"if",hash:{},fn:n.program(8,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:221},end:{line:1,column:264}}}))?r:"")+' tabindex="0"'},6:function(n,l,e,t,a){return" selected"},8:function(n,l,e,t,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return' data-title="'+n.escapeExpression("function"==typeof(r=null!=(r=o(e,"title")||(null!=l?o(l,"title"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"title",hash:{},data:a,loc:{start:{line:1,column:247},end:{line:1,column:256}}}):r)+'"'},10:function(n,l,e,t,a){return'"'},12:function(n,l,e,t,a){var r,o=n.lambda,i=n.escapeExpression,u=null!=l?l:n.nullContext||{},s=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<span class="item-icon"><span class="avatar tiny no-menu '+i(o(null!=(r=null!=l?s(l,"avatar"):l)?s(r,"type"):r,l))+'" title="'+i(o(null!=(r=null!=l?s(l,"avatar"):l)?s(r,"title"):r,l))+'"'+(null!=(r=s(e,"if").call(u,null!=(r=null!=l?s(l,"avatar"):l)?s(r,"groupNsid"):r,{name:"if",hash:{},fn:n.program(13,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:113},end:{line:2,column:183}}}))?r:"")+(null!=(r=s(e,"if").call(u,null!=(r=null!=l?s(l,"avatar"):l)?s(r,"personNsid"):r,{name:"if",hash:{},fn:n.program(15,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:183},end:{line:2,column:256}}}))?r:"")+' style="background-image: url('+i(o(null!=(r=null!=l?s(l,"avatar"):l)?s(r,"url"):r,l))+');"></span></span>'},13:function(n,l,e,t,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return' data-group-nsid="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"avatar"):l)?o(r,"groupNsid"):r,l))+'"'},15:function(n,l,e,t,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return' data-person-nsid="'+n.escapeExpression(n.lambda(null!=(r=null!=l?o(l,"avatar"):l)?o(r,"personNsid"):r,l))+'"'},17:function(n,l,e,t,a){var r,o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<span class="item-icon"><span class="'+n.escapeExpression("function"==typeof(r=null!=(r=o(e,"iconClass")||(null!=l?o(l,"iconClass"):l))?r:n.hooks.helperMissing)?r.call(null!=l?l:n.nullContext||{},{name:"iconClass",hash:{},data:a,loc:{start:{line:3,column:55},end:{line:3,column:68}}}):r)+'"></span></span>'},19:function(n,l,e,t,a){return'<span class="item-icon"></span>'},21:function(n,l,e,t,a){var r,o=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<span class="item-title'+(null!=(r=u(e,"if").call(o,null!=l?u(l,"header"):l,{name:"if",hash:{},fn:n.program(22,a,0),inverse:n.noop,data:a,loc:{start:{line:5,column:37},end:{line:5,column:67}}}))?r:"")+'">'+n.escapeExpression((u(e,"renderTrustedMarkup")||l&&u(l,"renderTrustedMarkup")||i).call(o,(u(e,"multiHighlightString")||l&&u(l,"multiHighlightString")||i).call(o,null!=l?u(l,"title"):l,null!=l?u(l,"titleHighlights"):l,"highlight",{name:"multiHighlightString",hash:{},data:a,loc:{start:{line:5,column:91},end:{line:5,column:147}}}),{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:5,column:69},end:{line:5,column:149}}}))+"</span>"},22:function(n,l,e,t,a){return" tertiary"},24:function(n,l,e,t,a){var r,o=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,u=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<span class="item-subtitle '+(null!=(r=u(e,"if").call(o,null!=l?u(l,"header"):l,{name:"if",hash:{},fn:n.program(25,a,0),inverse:n.program(27,a,0),data:a,loc:{start:{line:6,column:44},end:{line:6,column:85}}}))?r:"")+'">'+(null!=(r=u(e,"unless").call(o,null!=l?u(l,"header"):l,{name:"unless",hash:{},fn:n.program(29,a,0),inverse:n.noop,data:a,loc:{start:{line:6,column:87},end:{line:6,column:117}}}))?r:"")+n.escapeExpression((u(e,"renderTrustedMarkup")||l&&u(l,"renderTrustedMarkup")||i).call(o,(u(e,"multiHighlightString")||l&&u(l,"multiHighlightString")||i).call(o,null!=l?u(l,"subtitle"):l,null!=l?u(l,"subtitleHighlights"):l,"highlight",{name:"multiHighlightString",hash:{},data:a,loc:{start:{line:6,column:139},end:{line:6,column:201}}}),{name:"renderTrustedMarkup",hash:{},data:a,loc:{start:{line:6,column:117},end:{line:6,column:203}}}))+(null!=(r=u(e,"unless").call(o,null!=l?u(l,"header"):l,{name:"unless",hash:{},fn:n.program(31,a,0),inverse:n.noop,data:a,loc:{start:{line:6,column:203},end:{line:6,column:233}}}))?r:"")+"</span>"},25:function(n,l,e,t,a){return"link"},27:function(n,l,e,t,a){return"tertiary"},29:function(n,l,e,t,a){return"("},31:function(n,l,e,t,a){return")"},compiler:[8,">= 4.3.0"],main:function(n,l,e,t,a){var r,o=null!=l?l:n.nullContext||{},i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'<div class="autosuggest-item'+(null!=(r=i(e,"if").call(o,null!=l?i(l,"header"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:28},end:{line:1,column:56}}}))?r:"")+(null!=(r=i(e,"if").call(o,null!=l?i(l,"empty"):l,{name:"if",hash:{},fn:n.program(3,a,0),inverse:n.noop,data:a,loc:{start:{line:1,column:56},end:{line:1,column:82}}}))?r:"")+(null!=(r=i(e,"if").call(o,null!=l?i(l,"url"):l,{name:"if",hash:{},fn:n.program(5,a,0),inverse:n.program(10,a,0),data:a,loc:{start:{line:1,column:82},end:{line:1,column:293}}}))?r:"")+">\n\t"+(null!=(r=i(e,"if").call(o,null!=l?i(l,"avatar"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:1},end:{line:2,column:325}}}))?r:"")+"\n\t"+(null!=(r=i(e,"if").call(o,null!=l?i(l,"iconClass"):l,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:3,column:1},end:{line:3,column:91}}}))?r:"")+"\n\t"+(null!=(r=i(e,"if").call(o,null!=l?i(l,"useIconPlaceholder"):l,{name:"if",hash:{},fn:n.program(19,a,0),inverse:n.noop,data:a,loc:{start:{line:4,column:1},end:{line:4,column:65}}}))?r:"")+"\n\t"+(null!=(r=i(e,"if").call(o,null!=l?i(l,"title"):l,{name:"if",hash:{},fn:n.program(21,a,0),inverse:n.noop,data:a,loc:{start:{line:5,column:1},end:{line:5,column:163}}}))?r:"")+"\n\t"+(null!=(r=i(e,"if").call(o,null!=l?i(l,"subtitle"):l,{name:"if",hash:{},fn:n.program(24,a,0),inverse:n.noop,data:a,loc:{start:{line:6,column:1},end:{line:6,column:247}}}))?r:"")+"\n</div>\n"},useData:!0}),t={};n.Array.each([],(function(l){var e=n.Template.get("hermes/"+l);e&&(t[l]=e)})),n.Template.register("hermes/search-autosuggest-list-item",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(t,a.partials):t,e(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-search-autosuggest-items-list",(function(e,t){var a=e.Template.Handlebars.revive({1:function(e,t,a,s,r){var l,n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t<li class="autosuggest-list-elem" role="menuitem">'+(null!=(l=e.invokePartial(n(s,"search-autosuggest-list-item"),t,{name:"search-autosuggest-list-item",data:r,helpers:a,partials:s,decorators:e.decorators}))?l:"")+"</li>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,a,s,r){var l,n=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'<ul class="autosuggest-items-list" role="menu">\n'+(null!=(l=n(a,"each").call(null!=t?t:e.nullContext||{},null!=t?n(t,"autosuggestItems"):t,{name:"each",hash:{},fn:e.program(1,r,0),inverse:e.noop,data:r,loc:{start:{line:2,column:1},end:{line:4,column:10}}}))?l:"")+"</ul>\n"},usePartial:!0,useData:!0}),s={};e.Array.each(["search-autosuggest-list-item"],(function(t){var a=e.Template.get("hermes/"+t);a&&(s[t]=a)})),e.Template.register("hermes/search-autosuggest-items-list",(function(t,r){return(r=r||{}).partials=r.partials?e.merge(s,r.partials):s,a(t,r)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-search-autosuggest-list-item"]});YUI.add("autosuggest-data-manager",(function(e){var i;function t(e){return e.trim().split(/\s+/)}function r(i){var t=i.replace(/[\W,_]/g,"").toLowerCase();return e.fluid.removeDiacritics(t)}function n(e){var i,t,r="",n=e.split("");for(t=0,i=n.length;t<i-1;t++)r+=n[t]+"[\\W,_]*";return r+=n[i-1]}(i=e.AutosuggestDataManager=function(e){(e=e||{}).prefixTrie?this.prefixTrie=e.prefixTrie:this._buildPrefixTrie(e.items)}).locateQuery=function(e,i){var s,u,f,o,c,l,a,h=[],d={};if(!e||!i)return[];for(a=0,u=(s=t(e)).length;a<u;a++)d[f=r(s[a])]||(o=n(f),(c=new RegExp("(\\b|_)("+o+")","i").exec(i))&&(l=c.index+c[1].length,h.push({start:l,end:l+c[2].length})),d[f]=!0);return h},i.deserialize=function(e){return new i({prefixTrie:JSON.parse(e)})},i.prototype={add:function(e){var i,n,s,u,f=this,o=250;s=0,n=e.length,u=n>s+o?s+o:n,i=e.slice(s,u),s=u,(function i(c){var l,a,h,d,g,p,T,x,m,y,_;for(l=0,a=c.length;l<a;l++){if(g=[],(h=c[l]).title&&(g=g.concat(t(h.title))),h.subtitle&&(g=g.concat(t(h.subtitle))),h.aliases)for(_=0,d=h.aliases.length;_<d;_++)g=g.concat(t(h.aliases[_]));for(_=0,p=g.length;_<p;_++)for(T=g[_],x=f.prefixTrie,m=r(T).split("");y=m.shift();)x.children[y]=x.children[y]||f._newTrieNode(),(x=x.children[y]).itemKeys[h.key]||(x.items.push(h),x.itemKeys[h.key]=!0)}s<n&&(u=n>s+o?s+o:n,c=e.slice(s,u),s=u,setTimeout((function(){i(c)}),0))})(i)},query:function(e){var i,n,s,u,f,o=this;return e?(t(e).every((function(e){if(i=o.prefixTrie,!(n=r(e).split("")).length)return!0;for(;i&&(f=n.shift());)i=i.children[f];return i&&0===n.length?(s=i.items.slice(),!(u=u?o._intersectMatches(u,s):s)||0!==u.length):(u=[],!1)})),u||[]):[]},serialize:function(){return JSON.stringify(this.prefixTrie)},_buildPrefixTrie:function(e){this.prefixTrie=this._newTrieNode(),e&&this.add(e)},_newTrieNode:function(){return{items:[],itemKeys:{},children:{}}},_intersectMatches:function(e,i){return e.filter((function(e){return i.some((function(i){return i.key===e.key}))}))}}}),"@VERSION@",{requires:[],optionalRequires:["fluid"]});YUI.add("search-autosuggest-items-list-view",(function(e,t){var s=require("hermes-core/flog")(t),a=[{key:"photos",headerTemplate:{titleIntlKey:"search.PHOTOS",searchLink:{textIntlKey:"search.SEARCH_PHOTOS",searchType:e.SearchUrl.searchTypes.PHOTOS,rapidType:"searchPhotos",iconClass:"icon-photos"}}},{key:"people",headerTemplate:{titleIntlKey:"search.PEOPLE",searchLink:{textIntlKey:"search.SEARCH_PEOPLE",searchType:e.SearchUrl.searchTypes.PEOPLE,rapidType:"searchPeople",iconClass:"icon-people"}}},{key:"groups",headerTemplate:{titleIntlKey:"search.GROUPS",searchLink:{textIntlKey:"search.SEARCH_GROUPS",searchType:e.SearchUrl.searchTypes.GROUPS,rapidType:"searchGroups",iconClass:"icon-groups"}}},{key:"pages"}];e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.set("autosuggestItems",t.autosuggestItems||{}),this.set("searchUrl",new e.SearchUrl(this.appContext.getLocation().href,this.appContext)),this.set("searchQuery",""),this},loadState:function(){var e=this.appContext.getViewer().signedIn?this.appContext.getViewer().nsid+"_user":"global_global",t=this;return this.appContext.getModel("autosuggest-context-results-models",{id:e}).then((function(e){e&&(t.processTimeout=setTimeout((function(){t.processAutosuggestModels(e)}),1e3))}),(function(t){s.warn("error loading autosuggest data",{modelId:e})}))},processAutosuggestModels:function(t){var s={};t&&t.getValue("pages").length&&(s.pages=new e.AutosuggestDataManager({items:t.getValue("pages")})),t&&t.getValue("people").length&&(s.people=new e.AutosuggestDataManager({items:t.getValue("people")})),t&&t.getValue("groups").length&&(s.groups=new e.AutosuggestDataManager({items:t.getValue("groups")})),this.set("autosuggestDataManagers",s)},updateAutosuggestItems:function(e){var t,s=this.get("autosuggestDataManagers"),a={};t=function(e,t){return e.score&&t.score?t.score-e.score:0},e&&s&&(s.pages&&(a.pages=s.pages.query(e).sort(t)),s.people&&(a.people=s.people.query(e).sort(t)),s.groups&&(a.groups=s.groups.query(e).sort(t))),this.set("autosuggestItems",a||{}),this.set("searchQuery",e||""),this.set("previouslySelectedNode",null),this.buildContainer()},buildContainer:function(){return this.assembleAutosuggestItemsList(),this.setContainerWithTemplate("search-autosuggest-items-list",{autosuggestItems:this.get("autosuggestItemsList")}),this},activate:function(){var e=this.get("container");return this.registerEventHandler(e.delegate("blur",this.handleAutosuggestListItemBlur.bind(this),".autosuggest-selectable-item")),this.registerEventHandler(e.delegate("click",this.handleAutosuggestListItemClick.bind(this),".autosuggest-selectable-item")),this.registerEventHandler(e.delegate("mouseenter",this.handleAutosuggestListItemHoverOn.bind(this),".autosuggest-selectable-item")),this.registerEventHandler(e.delegate("keydown",this.handleAutosuggestListItemKeydown.bind(this),".autosuggest-selectable-item")),this},onParentViewEvent:function(t,s){switch(s&&s.length&&s[0]){case"update-autosuggest-items":this.updateAutosuggestItems(s[1],s[2]);break;case"enable-autosuggest":this.get("container").removeClass("disabled"),this.appContext.flipper.isFlipped("enable-nav-selecta")&&(console.log("enable-autosuggest"),e.fire("BoSelecta:enableAutoSuggest"));break;case"disable-autosuggest":this.get("container").addClass("disabled"),this.appContext.flipper.isFlipped("enable-nav-selecta")&&(e.fire("BoSelecta:disableAutoSuggest"),console.log("disable-autosuggest"));break;case"autosuggest-keyboard-nav":s[1]&&this.doKeyboardNav(s[1],!0)}},assembleAutosuggestItemsList:function(){var e,t,s=[],i=this.get("autosuggestItems")||{},r=this.get("searchQuery")||"";if(r)for(t=0;t<a.length;t++)e=a[t],i.hasOwnProperty(e.key)&&i[e.key].length?s.push(this.buildSectionHeaderItem(e.headerTemplate,r,!0)):e.headerTemplate&&s.push(this.buildSectionHeaderItem(e.headerTemplate,r,!1));s.length?(s[0].selected=!0,this.fire("subviewViewEvent","autosuggest-has-items")):this.fire("subviewViewEvent","autosuggest-no-items"),this.set("autosuggestItemsList",s)},buildSectionHeaderItem:function(e,t,s){var a={header:!0};return e?(a.iconClass="icon-search",e.searchLink&&(a.subtitle=this.intlMessage({intlName:e.searchLink.textIntlKey}),a.url=this.get("searchUrl").clone().createNewSearch(t).setSearchType(e.searchLink.searchType).getURL(),a.iconClass=e.searchLink.iconClass,a.rapidType=e.searchLink.rapidType)):a.empty=!0,a},buildAutosuggestListItem:function(t,s,a){var i,r,o={item:!0};return o.title=t.title||"",o.subtitle=t.subtitle||"",o.rapidType=s,o.titleHighlights=e.AutosuggestDataManager.locateQuery(a,o.title),o.subtitleHighlights=e.AutosuggestDataManager.locateQuery(a,o.subtitle),"pages"===s?(o.url=t.url||"",o.iconClass="icon-docs"):(i="groups"===s?"groups":"photos",(r=t.pathalias||t.nsid)&&(o.url="/"+i+"/"+r),t.nsid&&(t.iconserver||0===t.iconserver)&&(o.avatar={type:"groups"===s?"group":"person",title:o.title,url:e.URLHelper.getBuddyIconURL(t.nsid,Math.ceil(t.iconserver/1e3),t.iconserver),personNsid:"people"===s&&t.nsid,groupNsid:"groups"===s&&t.nsid})),o},handleAutosuggestListItemBlur:function(t){var s=this;setTimeout((function(){e.one(e.config.doc.activeElement).hasClass("autosuggest-selectable-item")||s.fire("subviewViewEvent","autosuggest-lost-all-focus")}),25)},handleAutosuggestListItemClick:function(e){this.navigateFromAutosuggestListNode(e.currentTarget)},handleAutosuggestListItemKeydown:function(t){var s="";if(t.halt(),!0===t.altKey)e.fire("transfer-to-gn-search",s);else if(t.keyCode>=48&&t.keyCode<=90)s=String.fromCharCode(t.keyCode),s=!0===t.shiftKey?s.toUpperCase():s.toLowerCase(),e.fire("transfer-to-gn-search",s);else switch(t.keyCode){case 8:this.fire("subviewViewEvent","backspace-focus");break;case 13:this.navigateFromAutosuggestListNode(t.target);break;case 27:this.blurAllAutosuggestListNodes();break;case 38:this.doKeyboardNav("up",!1);break;case 40:this.doKeyboardNav("down",!1)}},navigateFromAutosuggestListNode:function(t){var s,a,i;t&&(s=t.getData("href"),a=t.getData("title"),i=t.getData("track")),a&&this.fire("subviewViewEvent","autosuggest-update-field",a),s&&(e.rapidTracker.beacon(this.name,i),this.updateAutosuggestItems(),this.appContext.flapp.navigate(s))},blurAllAutosuggestListNodes:function(){var e=this.get("container").all(".autosuggest-selectable-item");(e?e.size():0)&&e.each((function(e){e.blur()}))},doKeyboardNav:function(e,t){var s,a=this.get("container").all(".autosuggest-selectable-item"),i=a?a.size():0,r=-1;i&&((s=this.get("container").one(".autosuggest-selectable-item.selected"))&&(r=a.indexOf(s)),a.removeClass("selected"),(r="up"===e?r-1:r+1)>=0&&r<i?((s=a.item(r)).addClass("selected"),s.focus()):t?(r=r<0?i-1:0,(s=a.item(r)).addClass("selected"),s.focus()):this.fire("subviewViewEvent","focus-search-field"))},handleAutosuggestListItemHoverOn:function(e){var t=this.get("container").one(".autosuggest-selectable-item.selected"),s=e.target;t&&t.removeClass("selected"),s.addClass("selected"),s.focus()},destructor:function(){this.processTimeout&&clearTimeout(this.processTimeout)}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-autosuggest-items-list","hermes-template-search-autosuggest-list-item","autosuggest-data-manager","search-url","search-helper","url-helper"],optionalRequires:["hermes-core"],langBundles:["search"]});YUI.add("search-autosuggest-field-view",(function(e){e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){var s=this.appContext.getLocation();return this.set("searchUrl",new e.SearchUrl(s.href,this.appContext)),this.set("siteSection",e.URLHelper.getSiteSectionByURL(s.pathname)),this.set("contextToString",{photos:this.intlMessage({intlName:"groups.PHOTOS"}),photostream:this.intlMessage({intlName:"groups.PHOTOS"}),favorites:this.intlMessage({intlName:"common.FAVORITES"}),faves:this.intlMessage({intlName:"common.FAVORITES"}),albums:this.intlMessage({intlName:"common.ALBUMS"}),everyone:this.intlMessage({intlName:"search.EVERYONE"}),contacts:this.intlMessage({intlName:"search.PEOPLE_YOU_FOLLOW"}),peopleYouFollow:this.intlMessage({intlName:"search.PEOPLE_YOU_FOLLOW"}),discussions:this.intlMessage({intlName:"groups.DISCUSSIONS_LINK_LABEL"})}),this.isSOHP=t.isSOHP,this.hasNavSelectaEnabled=this.appContext.flipper.isFlipped("enable-nav-selecta"),this.params=t,this},subviewConfig:{"search-autosuggest-items-list-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return this.appContext.getUA().isMobileOrTablet}},"search-w-navselecta-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1,disabled:function(){return!this.appContext.flipper.isFlipped("enable-nav-selecta")}}},loadState:function(){return this.getContextModelPromise()},buildContainer:function(){var e=this.get("context"),t=this.get("searchUrl").getSearchTerm(),s=[];return e&&e.type&&s.push({combo:!0,name:e.name,secondName:this.get("contextToString")[e.scope]}),this.setContainerWithTemplate("search-autosuggest-field",{searchTerm:t,pills:s,hasPills:s.length>0}),(s.length>0||t.length>0)&&this.get("container").addClass("expanded"),this},activate:function(){var t=this.get("container"),s=t.one("#search-field");t.one(".search-form");if(this.attachKeyEvent("up:83",this.focusSearchField.bind(this)),t.one("form")&&this.registerEventHandler(t.one("form").on("submit",this.executeSearch.bind(this))),this.registerEventHandler(e.on("add-context-to-search-field",this.addContext.bind(this))),this.registerEventHandler(e.on("transfer-to-gn-search",this.addSearchText.bind(this))),this.registerEventHandler(t.on("mousedown",this.handleMouseDown.bind(this))),!this.hasNavSelectaEnabled){this.registerEventHandler(s.on({valuechange:this.updateAutosuggestItems.bind(this),focus:this.handleSearchFieldFocus.bind(this),blur:this.handleSearchFieldBlur.bind(this)})),this.registerEventHandler(s.on("key",this.handleSearchFieldKeydown.bind(this),"down:27,38,40,8"));try{e.config.doc.activeElement.isEqualNode(s.getDOMNode())&&(this.blurSearchField(),this.focusSearchField())}catch(e){}return this}},getContextModelPromise:function(){var t=this.get("searchUrl").getAPIParams(),s=e.Promise.resolve(),a=null,i=this;return t[e.SearchHelper.API.groupId]?(a={type:"group",id:t[e.SearchHelper.API.groupId],scope:"photos"},s=this.appContext.getModel("group-info-models",a.id)):t[e.SearchHelper.API.userId]?(a={type:"user",id:t[e.SearchHelper.API.userId],scope:t[e.SearchHelper.API.faves]?"favorites":"photostream"},t[e.SearchHelper.API.faves]?a.scope="favorites":t[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]?a.scope="albums":a.scope="photostream",s=this.appContext.getModel("person-models",a.id)):t[e.SearchHelper.API.faves]?(a={type:"user",id:this.appContext.getViewer().nsid,scope:"favorites"},s=this.appContext.getModel("person-models",a.id)):t[e.SearchHelper.API.contacts]?a={type:"contacts",scope:"photos",name:this.get("contextToString").contacts}:t[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]&&(a={type:"everyone",scope:"photos",name:this.get("contextToString").everyone}),s.then((function(e){e&&(a.name="user"===a.type?e.getValue("displayname"):e.getValue("group").getValue("title")),i.set("context",a)}))},handleMouseDown:function(e){var t=e.target;1===e.which&&(t.hasClass("search-pill-remover")?(e.halt(),this.removeContext()):t.hasClass("search-icon-button")?(e.halt(),this.executeSearch(e)):(t.hasClass("search-pill")||t.hasClass("search-pillbox")||t.hasClass("search-form"))&&(e.halt(),this.focusSearchField()))},addSearchText:function(e){var t=this.get("container").one("#search-field");t.set("value",t.get("value")+e),this.hasNavSelectaEnabled?setTimeout(function(){this.focusSearchField()}.bind(this),300):this.focusSearchField()},addPill:function(t,s){var a,i={name:t};s&&(i.combo=!0,i.secondName=s),a=e.Node.create(this.templates("search-pill")(i)),this.get("container").one(".search-pillbox").appendChild(a)},removePills:function(){this.get("container").one(".search-pillbox").get("children").remove()},addContext:function(e){var t=this.get("context");t&&t.id===e.id&&t.name===e.name&&t.type===e.type&&t.scope===e.scope||(t&&t.type?(this.removeContext(),this.set("context",e),this.addPill(e.name,this.get("contextToString")[e.scope])):(this.set("context",e),this.addPill(e.name,this.get("contextToString")[e.scope]))),this.fire("parentViewEvent","disable-autosuggest"),this.get("container").one("#search-field").set("placeholder",""),this.focusSearchField()},removeContext:function(){var t=this.get("container"),s=t.one("#search-field");this.set("context",null),s.set("placeholder",this.intlMessage({intlName:"search.PHOTOS_PEOPLE_OR_GROUPS"})),this.removePills(),this.blurSearchBar(),e.fire("remove-context-in-search-field",{}),this.get("siteSection")&&"search"===this.get("siteSection").name&&s.get("value").length>0?this.executeSearch():(this.updateAutosuggestItems(),!this.appContext.flipper.isFlipped("enable-nav-selecta")&&t.hasClass("expanded")?this.fire("parentViewEvent","enable-autosuggest"):this.appContext.flipper.isFlipped("enable-nav-selecta")&&setTimeout(function(){this.fire("parentViewEvent","enable-autosuggest"),this.focusSearchField()}.bind(this),300))},onParentViewEvent:function(e,t){switch(t&&t.length&&t[0]){case"resize-search-field":this.resizeSearchField(t[1]);break;case"focus-search-field":this.focusSearchField();break;case"clear-search-field":this.clearSearchField()}},onSubviewEvent:function(e,t){var s,a,i=t&&t.length&&t[0],r=this.get("container");switch(i){case"autosuggest-lost-all-focus":this.handleAutosuggestBlur();break;case"focus-search-field":this.focusSearchField();break;case"autosuggest-no-items":r.removeClass("autosuggest-active");break;case"autosuggest-has-items":r.addClass("autosuggest-active");break;case"autosuggest-update-field":(a=r.one("#search-field"))&&"string"==typeof t[1]&&a.set("value",t[1]);break;case"backspace-focus":(a=r.one("#search-field"))&&(s=a.get("value"),a.set("value",s.substring(0,s.length-1)),this.focusSearchField())}},executeSearch:function(t){var s,a,i,r={};t&&t.halt(),s=this.get("container").one("#search-field").get("value"),(i=this.get("context"))&&i.type?("group"===i.type&&"discussions"===i.scope?(r.q=s,r.w=i.id,r.m="discuss",a=new e.SearchUrl(r,this.appContext,e.SearchUrl.searchTypes.CLASSIC_GROUPS)):("user"===i.type?(r[e.SearchHelper.API.userId]=i.id,"favorites"===i.scope?r[e.SearchHelper.API.faves]=1:"albums"===i.scope?r[e.SearchHelper.UNIFIED_STATE_PARAMS.albums]=1:r[e.SearchHelper.API.userId]=i.id):"group"===i.type?r[e.SearchHelper.API.groupId]=i.id:"contacts"===i.type?r[e.SearchHelper.API.contacts]="all":i.type,r[e.SearchHelper.UNIFIED_STATE_PARAMS.viewAll]=1,a=this.get("searchUrl"),Object.keys(r).forEach((function(e){a.setAPIParam(e,r[e])})),a.setSearchType(e.SearchUrl.searchTypes.PHOTOS),a.setSearchTerm(s)),e.rapidTracker.beacon(this.name,"searchWithContext_"+i.type+"_"+i.scope)):(a=this.get("searchUrl")).createNewSearch(s),this.appContext.flapp.navigate(a.getURL())},focusSearchField:function(e){this.appContext.overlayManager.popAll(),this.get("container").one("#search-field").focus()},blurSearchField:function(e){this.get("container").one("#search-field").blur()},resizeSearchField:function(e){e?(this.get("container").setStyle("width",e+"px"),this.get("container").one("#search-field").setStyle("width",e+"px")):(this.get("container").removeAttribute("style"),this.get("container").one("#search-field").removeAttribute("style"))},clearSearchField:function(e){this.get("container").one("#search-field").set("value","")},updateAutosuggestItems:function(e){var t;t=this.get("container").one("#search-field").get("value"),e&&e.halt(),this.get("context")||this.fire("parentViewEvent","update-autosuggest-items",t)},handleSearchFieldFocus:function(e){var t,s=this.get("container"),a=s.one(".search-form"),i=this;e.halt(),s.hasClass("focus")||(s.addClass("focus"),s.addClass("expanded"),this.expandTimer&&clearTimeout(this.expandTimer),this.get("context")||(t=this.registerEventHandler(a.on("transitionend",(function(){i.detachRegisteredEvent(t),i.updateAutosuggestItems(),s.hasClass("expanded")&&i.fire("parentViewEvent","enable-autosuggest")})))))},blurSearchBar:function(){clearTimeout(this.expandTimer),this.expandTimer=setTimeout(function(){var t=this.get("container"),s=this.get("context");e.one(e.config.doc.activeElement).hasClass("autosuggest-selectable-item")||(t.removeClass("focus"),t.removeClass("autosuggest-active"),s&&s.type||0!==t.one("#search-field").get("value").length||t.removeClass("expanded"),this.fire("parentViewEvent","disable-autosuggest"))}.bind(this),150)},handleSearchFieldBlur:function(e){e.halt(),e.relatedTarget&&e.relatedTarget.hasClass("search-icon-button")?this.executeSearch():this.blurSearchBar()},handleAutosuggestBlur:function(){this.blurSearchBar()},handleSearchFieldKeydown:function(t){var s=t.keyCode,a=t.target;switch(s){case 27:t.halt(),this.blurSearchField();break;case 38:t.halt(),this.fire("parentViewEvent","autosuggest-keyboard-nav","up");break;case 40:t.halt(),this.fire("parentViewEvent","autosuggest-keyboard-nav","down");break;case 8:0===e.fluid.getTextFieldCursorPosition(a)&&""===e.fluid.getTextFieldSelection()&&this.removeContext()}},destructor:function(){clearTimeout(this.expandTimer),this.expandTimer=null}})}),"@VERSION@",{requires:["flickr-view","flickr-promise","hermes-template-search-autosuggest-field","hermes-template-search-pill","search-url","autosuggest-context-results-models","storage-helper","search-autosuggest-items-list-view","url-helper"],optionalRequires:["fluid"],langBundles:["search","common","groups"]});YUI.add("hermes-template-notifications-menu",(function(n,e){var t=n.Template.Handlebars.revive({1:function(n,e,t,a,i){var o,l=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return n.escapeExpression("function"==typeof(o=null!=(o=l(t,"unseenNotificationCount")||(null!=e?l(e,"unseenNotificationCount"):e))?o:n.hooks.helperMissing)?o.call(null!=e?e:n.nullContext||{},{name:"unseenNotificationCount",hash:{},data:i,loc:{start:{line:7,column:81},end:{line:7,column:108}}}):o)},compiler:[8,">= 4.3.0"],main:function(n,e,t,a,i){var o,l=null!=e?e:n.nullContext||{},s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<a class="gn-title c-notifications-menu"\n\ttabindex="0"\n\taria-haspopup="true"\n\taria-expanded="false"\n\taria-label="'+n.escapeExpression((s(t,"intlMessage")||e&&s(e,"intlMessage")||n.hooks.helperMissing).call(l,{name:"intlMessage",hash:{intlName:"notifications.NOTIFICATIONS"},data:i,loc:{start:{line:5,column:13},end:{line:5,column:67}}}))+'">\n\t<span class="c-notification-icon" aria-hidden="true">\n\t\t<span class="c-notification-unseencount hidden">'+(null!=(o=s(t,"if").call(l,null!=e?s(e,"unseenNotificationCount"):e,{name:"if",hash:{},fn:n.program(1,i,0),inverse:n.noop,data:i,loc:{start:{line:7,column:50},end:{line:7,column:115}}}))?o:"")+"</span>\n\t</span>\n</a>\n"},useData:!0}),a={};n.Array.each([],(function(e){var t=n.Template.get("hermes/"+e);t&&(a[e]=t)})),n.Template.register("hermes/notifications-menu",(function(e,i){return(i=i||{}).partials=i.partials?n.merge(a,i.partials):a,t(e,i)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});