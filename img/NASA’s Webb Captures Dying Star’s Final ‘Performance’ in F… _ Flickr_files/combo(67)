YUI.add("user-account-card-view",(function(e,t){var i=require("hermes-core/flog")(t),s=new e.SubscriptionsHelper;e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){this.params=e},loadState:function(){var t=this,s=[],o=this.appContext.getViewer().nsid;return s.push(this.appContext.getModel("person-models",o).then((function(e){if(t.userModel=e,e.getValue("isPro"))return t.appContext.getModel("effective-subscriptions-models",e.id).then((function(e){t.effectiveSubscriptions=e})).catch((function(e){i.error(e),t.effectiveSubscriptions=!1}))}))),s.push(this.appContext.getModel("person-profile-models",o).then((function(e){t.profileModel=e}))),e.Promise.all(s)},buildContainer:function(){var t,i=this.profileModel.getValue("photoCount"),o=e.config.flickr.account.photo_limit,r=this.profileModel.getValue("unreadMessages"),n=new e.moment(this.userModel.getValue("dateCreated"));n.add(1,"d");var a=!n.isBefore(e.moment());this.userModel.getValue("isPro")&&this.effectiveSubscriptions&&(t=this.effectiveSubscriptions.getValue("closed").length>0&&0===this.effectiveSubscriptions.getValue("pending").length);var l={user:{isPro:this.userModel.getValue("isPro"),proBadge:this.userModel.getValue("proBadge"),csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:"",upgradeURLProBadge:s.getProLandingPageUrl(s.UTM_PRO_BADGE,{utm_medium:this.name})},itemCount:i,itemLimit:o,limitReached:e.UserLimitsHelper.hasReachedUploadLimit(this.profileModel,this.appContext),isUnder500:i<=500,isClosedPro:t,unreadCount:r,hasUnreadMessages:r>0,attrs:{user:{username:this.userModel.getValue("username")}},greeting:a?e.Greetings.getDefaultGreeting({username:this.userModel.getValue("username"),url:this.userModel.getValue("url")}):e.Greetings.getRandomGreeting({username:this.userModel.getValue("username"),url:this.userModel.getValue("url")}),showOverLimitWarning:this.appContext.getCookie(e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isOverARRLimit(this.profileModel,this.appContext),upgradeURLUpsell:s.getProLandingPageUrl(s.UTM_UPSELL_LINK,{utm_medium:"user-account-card-unlimited-uploads"}),canSeePrioritySupportUpsell:!this.userModel.getValue("isPro")&&!this.appContext.getCookie(e.config.flickr.upsells.dismiss_priority_support_assistance_upsell_name)&&this.appContext.flipper.isFlipped("enable-upsell-priority-support"),upgradeURLPriorityAssistance:"/account/upgrade/pro?utm_campaign=web&utm_source=desktop&utm_medium=priority_support_upsell&utm_content=upgrade"},u=Object.assign(l,this.params);this.setContainerWithTemplate("user-account-card",u)},activate:function(){var e=this.get("container");this.graphContainer=e.one(".storage-section .graph"),this.learnMoreButton=e.one(".storage-section .over-limit-learn-button"),this.upsellDismiss=e.one(".upsell-dismiss"),this.graphContainer&&this.drawStorageGraph(),this.learnMoreButton&&this.registerEventHandler(this.learnMoreButton.on("click",this.handleLearnMoreClick.bind(this))),this.upsellDismiss&&this.registerEventHandler(this.upsellDismiss.on("click",this.dismissUpsellSection.bind(this)))},drawStorageGraph:function(){var t,i,s=e.config.flickr.account.photo_limit;i=(t=this.profileModel.getValue("photoCount")/s||0)>.1?[{durationProportion:.2,fillProportion:.001},{durationProportion:1,fillProportion:t,easeFunction:"easeInOutQuad"}]:[{durationProportion:.2,fillProportion:.001},{durationProportion:.65,fillProportion:.7,easeFunction:"easeOutQuad"},{durationProportion:1,fillProportion:t,easeFunction:"easeInOutQuad"}],new e.CircleFillGraph({containerElement:this.graphContainer.getDOMNode(),lineWidth:2,backgroundStrokeColor:"#e1e1e1",gradient:[{fillProportion:0,value:"5BF4FC"},{fillProportion:.3,value:"33b7ff"},{fillProportion:.7,value:"FF0084"},{fillProportion:1,value:"FF0084"}],duration:1.4,stops:i,segments:120}).start()},handleLearnMoreClick:function(t){e.fire("accountCard:overLimitLearnMoreClick"),e.fire("accountCard:close")},dismissUpsellSection:function(){var t=this.get("container").one(".upsell-section"),i=new Date;i.setTime(i.getTime()+31536e6),t&&t.addClass("hidden"),this.appContext.cookieCatcher.setCookieIfAllowed(e.config.flickr.upsells.dismiss_priority_support_assistance_upsell_name,1,{expires:i,path:"/"}),e.Snowplough.sendStructuredEvent({category:"upsell-priority-support",action:"dismiss",label:this.name})}})}),"@VERSION@",{requires:["hermes-template-user-account-card","circle-fill-graph","intl-number","handlebars-helpers","greetings-helper","subscriptions-helper","user-limits-helper","moment"],optionalRequires:["hermes-core"],langBundles:["common","account-menu","notifications","stats"]});YUI.add("hermes-lang-account-menu",(function(e,o){e.Intl.add("hermes/account-menu","en-US",{SPACE_USED:[{type:0,value:"Using "},{type:1,value:"percentage"},{type:0,value:"% of "},{type:1,value:"total"}],SPACE_USED_STYLEGUIDE:[{type:1,value:"percentage"},{type:0,value:"% used of "},{type:1,value:"total"}],SPACE_USED_UNLIMITED:[{type:0,value:"Using "},{type:1,value:"used"},{type:0,value:" of your unlimited storage"}],PHOTO_COUNT_MANY:[{type:2,value:"num",style:null},{type:0,value:" photos"}],PHOTO_COUNT_ONE:[{type:0,value:"One photo"}],PHOTO_COUNT_NONE:[{type:0,value:"No photos"}],PHOTO_COUNT_1K:[{type:2,value:"num",style:null},{type:0,value:"k photos"}],ADDMORESPACE:[{type:0,value:"Add more space"}],GOADFREE:[{type:0,value:"Go Ad Free"}],GOPRO:[{type:0,value:"Go Pro"}],GETPRO:[{type:0,value:"Get Pro"}],RESUBSCRIBE_TO_PRO:[{type:0,value:"Re-subscribe to Pro"}],GREETING_CAPTION_SPANISH:[{type:0,value:"Now you know how to greet people in Spanish"}],GREETING_CAPTION_GERMAN:[{type:0,value:"Now you know how to greet people in German"}],GREETING_CAPTION_AUSTRALIAN:[{type:0,value:"Now you know how to greet people in Australian"}],GREETING_CAPTION_DUTCH:[{type:0,value:"Now you know how to greet people in Dutch"}],GREETING_CAPTION_ENGLISH:[{type:0,value:"Now you know how to greet people in English"}],GREETING_CAPTION_ARABIC:[{type:0,value:"Now you know how to greet people in Arabic"}],GREETING_CAPTION_FRENCH:[{type:0,value:"Now you know how to greet people in French"}],GREETING_CAPTION_ITALIAN:[{type:0,value:"Now you know how to greet people in Italian"}],GREETING_CAPTION_SWEDISH:[{type:0,value:"Now you know how to greet people in Swedish"}],GREETING_CAPTION_HAWAIIAN:[{type:0,value:"Now you know how to greet people in Hawaiian"}],GREETING_CAPTION_TAGALOG:[{type:0,value:"Now you know how to greet people in Tagalog"}],GREETING_CAPTION_HEBREW:[{type:0,value:"Now you know how to greet people in Hebrew"}],GREETING_CAPTION_HINDI:[{type:0,value:"Now you know how to greet people in Hindi"}],GREETING_CAPTION_MANDARIN:[{type:0,value:"Now you know how to greet people in Mandarin"}],GREETING_CAPTION_PORTUGUESE:[{type:0,value:"Now you know how to greet people in Portuguese"}],GREETING_CAPTION_ALBANIAN:[{type:0,value:"Now you know how to greet people in Albanian"}],GREETING_CAPTION_ESTONIAN:[{type:0,value:"Now you know how to greet people in Estonian"}],GREETING_CAPTION_GREEK:[{type:0,value:"Now you know how to greet people in Greek"}],GREETING_CAPTION_HUNGARIAN:[{type:0,value:"Now you know how to greet people in Hungarian"}],GREETING_CAPTION_LINGALA:[{type:0,value:"Now you know how to greet people in Lingala"}],GREETING_CAPTION_SWAHILI:[{type:0,value:"Now you know how to greet people in Swahili"}],GREETING_CAPTION_TSHILUBA:[{type:0,value:"Now you know how to greet people in Tshiluba"}],GREETING_CAPTION_TURKISH:[{type:0,value:"Now you know how to greet people in Turkish"}],GREETING_CAPTION_BURMESE:[{type:0,value:"Now you know how to greet people in Burmese"}],GREETING_CAPTION_ICELANDIC:[{type:0,value:"Now you know how to greet people in Icelandic"}],GREETING_CAPTION_ZULU:[{type:0,value:"Now you know how to greet people in Zulu"}],GREETING_CAPTION_KOREAN:[{type:0,value:"Now you know how to greet people in Korean"}],GREETING_CAPTION_IRISH:[{type:0,value:"Now you know how to greet people in Irish"}],GREETING_CAPTION_LATVIAN:[{type:0,value:"Now you know how to greet people in Latvian"}],GREETING_CAPTION_BASQUE:[{type:0,value:"Now you know how to greet people in Basque"}],GREETING_CAPTION_BENGALI:[{type:0,value:"Now you know how to greet people in Bengali"}],GREETING_CAPTION_BULGARIAN:[{type:0,value:"Now you know how to greet people in Bulgarian"}],GREETING_CAPTION_CROATIAN:[{type:0,value:"Now you know how to greet people in Croatian"}],GREETING_CAPTION_CZECH:[{type:0,value:"Now you know how to greet people in Czech"}],GREETING_CAPTION_DANISH:[{type:0,value:"Now you know how to greet people in Danish"}],GREETING_CAPTION_FINNISH:[{type:0,value:"Now you know how to greet people in Finnish"}],GREETING_CAPTION_HOPI:[{type:0,value:"Now you know how to greet people in Hopi"}],GREETING_CAPTION_INDONESIAN:[{type:0,value:"Now you know how to greet people in Indonesian"}],GREETING_CAPTION_KANNADA:[{type:0,value:"Now you know how to greet people in Kannada"}],GREETING_CAPTION_KURDISH:[{type:0,value:"Now you know how to greet people in Kurdish"}],GREETING_CAPTION_LITHUANIAN:[{type:0,value:"Now you know how to greet people in Lithuanian"}],GREETING_CAPTION_MALAYSIAN:[{type:0,value:"Now you know how to greet people in Malaysian"}],GREETING_CAPTION_NORWEGIAN:[{type:0,value:"Now you know how to greet people in Norwegian"}],GREETING_CAPTION_POLISH:[{type:0,value:"Now you know how to greet people in Polish"}],GREETING_CAPTION_ROMANIAN:[{type:0,value:"Now you know how to greet people in Romanian"}],GREETING_CAPTION_RUSSIAN:[{type:0,value:"Now you know how to greet people in Russian"}],GREETING_CAPTION_SERBIAN:[{type:0,value:"Now you know how to greet people in Serbian"}],GREETING_CAPTION_SLOVAKIAN:[{type:0,value:"Now you know how to greet people in Slovakian"}],GREETING_CAPTION_UKRAINIAN:[{type:0,value:"Now you know how to greet people in Ukrainian"}],GREETING_CAPTION_VIETNAMESE:[{type:0,value:"Now you know how to greet people in Vietnamese"}],ITEM_COUNT_OF_LIMIT:[{type:1,value:"count"},{type:0,value:" of "},{type:1,value:"limit"},{type:0,value:" items"}],GET_UNLIMITED_UPLOADS:[{type:0,value:"Get unlimited uploads"}],UPLOAD_YOUR_PHOTOS:[{type:0,value:"Upload your photos"}],ITEM_LIMIT_REACHED:[{type:1,value:"limit"},{type:0,value:" item limit reached!"}],ITEM_LIMIT_EXCEEDED:[{type:1,value:"limit"},{type:0,value:" item limit exceeded!"}],GREETING_DEFAULT:[{type:0,value:'Hi, <a class="greeting-name" href="'},{type:1,value:"url"},{type:0,value:'">'},{type:1,value:"username"},{type:0,value:"</a>!"}],PRO_ASSISTANCE_UPSELL:[{type:0,value:'Get priority assistance from our world-class support heroes as a Flickr Pro. <a class="upgrade-pro-link" href="'},{type:1,value:"upgradeUrl"},{type:0,value:'">Upgrade now</a>'}]})}),"@VERSION@",{requires:["intl"]});YUI.add("account-menu-view",(function(e,t){"use strict";require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("account-menu-view",e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return this},loadState:function(){var t=this,o=[],n=this.appContext.getViewer();return n.signedIn?(t.set("user",{signedIn:!0,csrf:this.appContext.auth.csrf?this.appContext.auth.csrf:""}),o.push(this.appContext.getModel("person-models",n.nsid).then((function(o){var n=o.toJSON();Object.keys(n.buddyicon||{}).forEach((function(e){n.buddyicon[e]||(n.buddyicon[e]=n.buddyicon.default)})),t.set("user",e.merge(t.get("user"),n))}))),o.push(t.appContext.getModel("person-profile-models",n.nsid).then((function(o){var n=o.toJSON();n.unreadMessages=parseInt(n.unreadMessages,10),n.storageUsed=parseInt(n.storageUsed,10),n.storageTotal=parseInt(n.storageTotal,10),t.set("profileModel",o),t.set("user",e.merge(t.get("user"),n))}))),e.Promise.all(o).then((function(){t.set("showOverLimitWarning",t.appContext.getCookie(e.config.flickr.upload_blocking.dismiss_over_upload_limit_message_cookie_name)&&e.UserLimitsHelper.isOverARRLimit(t.get("profileModel"),t.appContext))}))):(t.set("user",{signedIn:!1}),e.Promise.resolve())},buildContainer:function(){return this.setContainerWithTemplate("account-menu",this.toJSON()),this},toJSON:function(){var t=e.merge(this.get("user")),o=this.appContext.lang;return parseInt(t.photoCount,10)>1?t.pluralPhotos=!0:t.pluralPhotos=!1,parseInt(t.photoCount,10)<1&&(t.photoCount=!1),t.photoCount>1e3&&(t.photoCount=Math.round(t.photoCount/1e3),t.oneK=!0),t.isPro?t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal):t.hasUnlimitedStorage?t.storageTotalFormatted="":t.has1TB?t.storageTotalFormatted="1TB":t.has2TB?t.storageTotalFormatted="2TB":t.storageTotalFormatted=t.storageTotal<0?"":e.Handlebars.helpers.friendlyDataSize(t.storageTotal),"vi-vn"===o.toLowerCase()&&(o="vn-VN"),t.storageUsedPercentage=Math.floor(1e3*t.storageUsed/t.storageTotal)/10||"0.0",t.storageUsedFormatted=e.Handlebars.helpers.friendlyDataSize(t.storageUsed),t.barWidth=Math.floor(t.storageUsedPercentage/100*293),t.unreadMessages=t.unreadMessages>9999?"9999+":t.unreadMessages,{user:t,helpLocaleKey:o.replace("-","_")||"en_US",flippers:this.appContext.flipper.toJSON(),showOverLimitWarning:this.get("showOverLimitWarning")}},activate:function(){e.on("notifications:openAccountMenuClicked",function(e){this.openUserAccountCard(!0)}.bind(this)),setTimeout(function(){this.get("container").on(["click","keydown"],(function(e){"click"!==e.type&&13!==e.keyCode&&32!==e.keyCode||(e.preventDefault(),e.stopPropagation(),this.openUserAccountCard())}),this)}.bind(this),350)},openUserAccountCard:function(t){var o=this,n=this.get("container"),a=new e.Views["user-account-card-view"]({appContext:this.appContext,showHighlight:t});this.accountMenu=new e.Views.FluidDroparound({appContext:this.appContext,dismissOnOverlayClick:!0,showDropArrow:!0,preferTop:!0,width:300,height:"auto",autoSizeToContent:!0,anchorOffsetVertical:-6,anchorElement:n.one(".c-account-menu"),keyboardAnchorElement:n.one("a[aria-haspopup=true]"),subview:a,contentPadding:0,preventPageScrollOnScroll:!0,useDefaultKeyboardNavigation:!1,classList:"user-account-card-droparound",positionFixed:!0}),this.accountMenu.show(),e.on("accountCard:close",(function(){o.accountMenu.close()}))},closeMenu:function(e){e&&e.preventDefault(),this.accountMenuDialog&&this.accountMenuDialog.close()},destructor:function(){this.accountMenuDialog&&(this.accountMenuDialog.destroy(),this.accountMenuDialog=null)}})}),"@VERSION@",{requires:["flickr-view","hermes-template-account-menu","hermes-template-account-menu-card","fluid-droparound-view","user-account-card-view"],optionalRequires:["hermes-core"],optional:["person-models","person-profile-models"],langBundles:["account-menu","common","autosuggest"]});