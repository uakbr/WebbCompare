YUI.add("flickr-photos-getContext-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-photos-getContext"]={run:function(t,s){var r=this;return e.Promise.all([s.callAPI("flickr.photos.getContext",this._processParams(t,s),!0),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models")]).then((function(e){return r._processResponse(e,t)}),e.FetcherErrorLogger(o))},_processParams:function(o,t){var s;return s={photo_id:o.photoId,num_prev:o.numNext,num_next:o.numPrev,extras:e.APIHelper.request.getRebootPhotoExtras()},o.viewAs&&(s.view_as=o.viewAs),o.orderBy&&(s.order_by=o.orderBy),s},_processResponse:function(o,t){var s,r,n,p,a,i,h,l,d=o[0],g=o[1],u=o[2],m=o[3],c=o[4],x=[],y=u.proxy(t.photoId),M=y.getValue("owner");return r=d.prevphotos,n=d.nextphotos,s=e.APIHelper.response.parsePhotos({photos:r.photo,existingPerson:M,photoModelRegistry:u,photoEngagementModelRegistry:m,photoStatsModelRegistry:c}),x=e.APIHelper.response.parsePhotos({photos:n.photo,existingPerson:M,photoModelRegistry:u,photoEngagementModelRegistry:m,photoStatsModelRegistry:c}),i=!!(a=g.getValue(t.id,"photoContextList")).hasMinBoundary&&a.hasMinBoundary(),h=!!a.hasMaxBoundary&&a.hasMaxBoundary(),p=a.getList(),l=e.APIHelper.response.addOrReplaceListByContext({model:y,next:s,prev:x.reverse(),hasMin:i,hasMax:h,current:p,numNext:t.numNext,numPrev:t.numPrev}),g.setValue(t.id,"photoContextList",l),{next:s,previous:x.reverse()}}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photostream-models","photo-models","photo-engagement-models","photo-stats-models"]});YUI.add("flickr-photos-getPerms-fetcher",(function(e,r){"use strict";e.namespace("ModelFetchers")["flickr-photos-getPerms"]={run:function(s,i){var o={photo_id:s.id},t=this;return e.Promise.all([i.callAPI("flickr.photos.getPerms",o),i.getModelRegistry("photo-privacy-models")]).then((function(e){return t._processResponse(e,s)}),e.FetcherErrorLogger(r))},_processResponse:function(e,r){var s,i=e[0],o=e[1];s={id:r.id,isPublic:i.perms.ispublic,isVisibleByFriends:i.perms.isfriend,isVisibleByFamily:i.perms.isfamily,permAddMeta:i.perms.permaddmeta,permComment:i.perms.permcomment},o.addOrUpdate(s)}}}),"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-privacy-models"]});YUI.add("photo-privacy-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)},update:function(t,r){var i;return i={photo_id:t,is_public:this.getValue(t,"isPublic"),is_friend:this.getValue(t,"isVisibleByFriends"),is_family:this.getValue(t,"isVisibleByFamily"),perm_addmeta:this.getValue(t,"permAddMeta"),perm_comment:this.getValue(t,"permComment"),perm_print:this.getValue(t,"permPrint")},e.ModelUpdaters["flickr-photos-setPerms"].run(i,this.appContext)},batchUpdate:function(t,r){var i={};return i.photo_ids=t,"privacy"in r&&(i.is_public=r.privacy.isPublic,i.is_friend=r.privacy.isVisibleByFriends,i.is_family=r.privacy.isVisibleByFamily),"commenting"in r&&(i.perm_comment=r.commenting),"addMeta"in r&&(i.perm_addmeta=r.addMeta),"permPrint"in r&&(i.perm_print=r.permPrint),i.full_response=1,e.ModelUpdaters["flickr-photos-setPerms"].run(i,this.appContext)}},attributes:{isPublic:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFriends:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isVisibleByFamily:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isHidden:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},permAddMeta:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permComment:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0},permPrint:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:0}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-photos-getPerms-fetcher","flickr-photos-setPerms-updater","attribute-helpers"]});YUI.add("flickr-people-getPhotos-fetcher",(function(e,o){"use strict";e.namespace("ListFetchers")["flickr-people-getPhotos"]={run:function(t,s){var r=this,p=[s.callAPI("flickr.people.getPhotos",this._processParams(t),!0),s.getModelRegistry("photo-models"),s.getModelRegistry("person-models"),s.getModelRegistry("photostream-models"),s.getModelRegistry("photo-engagement-models"),s.getModelRegistry("photo-stats-models"),s.getModelRegistry("photo-privacy-models")];return t.createCompoundID&&s.getViewer().signedIn&&s.getViewer().nsid&&p.push(s.getModel("person-preferences-models",s.getViewer().nsid)),e.Promise.all(p).then((function(e){return r._processResponse(e,t)}),e.FetcherErrorLogger(o))},_processParams:function(o){var t={per_page:o.perPage||20,page:o.page||1,extras:e.APIHelper.request.getRebootPhotoExtras(),get_user_info:1,jump_to:o.withPhotoId||""};return o.id||o.userId?t.user_id=(o.id||o.userId).split("-")[0]:o.pathAlias&&(t.path_alias=o.pathAlias),o.privacyFilter&&(t.privacy_filter=o.privacyFilter),o.viewAs&&(t.view_as=o.viewAs),o.orderBy&&("datetaken"===o.orderBy?t.sort="date-taken-desc":t.sort=o.orderBy),o.safeSearch&&(t.safe_search=o.safeSearch),o.media&&(t.media=o.media),o.withPhotoId&&(t.jump_to=o.withPhotoId),o.contentType&&(t.content_type=o.contentType),t},_processResponse:function(o,t){var s,r,p=o[0],a=o[1],i=o[2],d=o[3],n=o[4],l=o[5],h=o[6],g=p&&p.user?p.user.nsid:null,c=t.id||t.userId;if(!g)throw new Error("API was missing valid nsid");return r={id:g,pathAlias:p.user.pathAlias,owner:e.APIHelper.response.parsePerson(p.user),totalItems:p.photos.total},c&&c!==g&&(r.id=c),o[7]&&(r.id=g+"-"+e.Models["person-preferences-models"].buildContextSuffix(o[7],g)),r.owner=i.addOrUpdate(r.owner),s=e.APIHelper.response.parsePhotos({photos:p.photos.photo,ownerID:p.photos.owner,personModelRegistry:i,photoModelRegistry:a,photoEngagementModelRegistry:n,photoStatsModelRegistry:l,photoPrivacyModelRegistry:h}),r.photoPageList={perPage:p.photos.perpage,page:p.photos.page,pageContent:s,totalItems:parseInt(p.photos.total,10)||0},d.addOrUpdate(r),s}}}),"@VERSION@",{requires:["flickr-promise","api-helper","person-preferences-models"],optional:["photo-models","person-models","photostream-models","photo-engagement-models","photo-stats-models","photo-privacy-models"]});YUI.add("photostream-models",(function(e,t){function r(e){r.superclass.constructor.call(this,e)}e.Models[this.name]=r,e.extend(r,e.FlickrModelRegistry,{langBundles:this.details.langBundles,name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-people-getPhotos"].run(t,this.appContext)}},attributes:{normalizedId:{readOnly:!0,defaultFn:function(e){return e.split("-")[0]}},displayType:{readOnly:!0,defaultFn:function(){return"photostream"}},title:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t,r=this.appContext.getViewer(),n=this.getValue(e,"normalizedId");return r&&r.nsid===n?this.intlMessage({intlName:"models.YOUR_PHOTOSTREAM"}):(t=this.getValue(e,"owner"))?this.intlMessage({intlName:"models.USER_PHOTOSTREAM",name:t.getValue("displayname")}):this.intlMessage({intlName:"models.PHOTOSTREAM"})}},pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return this.getValue(e,"normalizedId")}},owner:{isModel:!0},isOwner:e.PhotoModelHelper.attributes.isOwner,photoPageList:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-people-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:e.ListFetchers["flickr-photos-getContext"],listItemIdField:"photoId"}},url:{readOnly:!0,derivedBy:["owner","normalizedId"],defaultFn:function(e){var t=this.getValue(e,"owner"),r=this.getValue(e,"normalizedId");return"/photos/"+(t?t.getValue("pathAlias"):r)+"/"}},totalItems:{defaultFn:function(){return null}},urlSuffix:{readOnly:!0,defaultFn:function(e){var t,n=r.splitCompoundId(e);return n.orderBy?(t=n.orderBy,n.viewAs?t+="-"+n.viewAs:"dateposted"===n.orderBy&&(t="photostream")):t="photostream",t}}}},{buildCompoundId:function(e,t,r){var n=e;return t&&(n+="-"+t),r&&(t||(n+="-dateposted"),n+="-"+r),n},splitCompoundId:function(e){var t=e.split("-");return{nsid:t[0],orderBy:t[1],viewAs:t[2]}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getContext-fetcher","flickr-people-getPhotos-fetcher","photo-model-helper"],langBundles:["models"]});YUI.add("person-model-helper",(function(e){e.PersonModelHelper={attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)||void 0},defaultFn:function(e){return e}},username:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},realname:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},displayname:{readOnly:!0,derivedBy:["username","realname"],getter:function(e,t){return this.getValue(t,"realname")||this.getValue(t,"username")}},nsid:{readOnly:!0,defaultFn:function(e){return e}},url:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(e){return"/photos/"+this.getValue(e,"pathAlias")+"/"}},isMe:{readOnly:!0,defaultFn:function(e){var t=this.appContext.getViewer();return t.signedIn&&t.nsid===e}}}}}),"@VERSION@",{requires:[]});YUI.add("person-models",(function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-people-getInfo"].run(t,this.appContext)}},attributes:{pathAlias:e.PersonModelHelper.attributes.pathAlias,username:e.PersonModelHelper.attributes.username,realname:e.PersonModelHelper.attributes.realname,displayname:e.PersonModelHelper.attributes.displayname,nsid:e.PersonModelHelper.attributes.nsid,url:e.PersonModelHelper.attributes.url,isMe:e.PersonModelHelper.attributes.isMe,buddyicon:{},isPro:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proBadge:{validator:function(t){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)}},isMinor:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},proExpireDate:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},isDeleted:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isAdFree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},isNoAds:{derivedBy:["isPro","isAdFree"],readOnly:!0,getter:function(e,t){var r=this.getValue(t,"isPro"),n=this.getValue(t,"isAdFree");return r||n}},hasStats:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasAdfree:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has1TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},has2TB:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasUnlimitedStorage:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeStandardShipping:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},hasFreeEducationalResources:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)}},dateCreated:{validator:function(t){return e.AttributeHelpers.validateDate(t)},setter:function(t){return e.AttributeHelpers.coerceDate(t)},serialize:function(e){return e.format("X")},deserialize:function(t){return e.moment(t,"X")}},location:{defaultFn:function(){return""}},expiringPartner:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultFn:function(){return!1}},uploadCount:{defaultValue:null},uploadLimit:{defaultValue:null},uploadLimitStatus:{defaultValue:null},isCognitoUser:{defaultValue:null},hasAuthorizedMobile:{defaultValue:null},hasInvalidEmail:{defaultValue:!1},subscription:{defaultValue:{isPastDue:!1,isPro:!1,isClosed:!1}},contactsCacheUrl:{defaultValue:!1},segments:{defaultValue:[]},isEligibleForGifts:{defaultValue:!1},eligibleGifts:{defaultValue:[]},newFlow:{defaultValue:!1}}})}),"@VERSION@",{requires:["flickr-model-registry","flickr-people-getInfo-fetcher","attribute-helpers","person-model-helper","moment"]});YUI.add("flickr-people-getInfo-fetcher",(function(e,s){"use strict";var r=new e.SubscriptionsHelper,o=require("hermes-core/flog")(s);e.namespace("ModelFetchers")["flickr-people-getInfo"]={run:function(r,o){var t=this,i=o.getViewer();return i&&i.signedIn&&(r.id===i.nsid||r.nsid===i.nsid)&&(r.storage=1),new e.FlickrPromise({apiResponse:o.callAPI("flickr.people.getInfo",this._processParams(r,o),!0),personModelRegistry:o.getModelRegistry("person-models"),personRelationshipModelRegistry:o.getModelRegistry("person-relationship-models"),personProfileModelRegistry:o.getModelRegistry("person-profile-models"),personPreferencesModelRegistry:o.getModelRegistry("person-preferences-models"),personGroupsModelRegistry:o.getModelRegistry("person-groups-models"),personNotificationsModelRegistry:o.getModelRegistry("person-notifications-models"),photostreamModelRegistry:o.getModelRegistry("photostream-models")}).then((function(e){return t._processResponse(e,r,o)}),e.FetcherErrorLogger(s))},_processParams:function(s,r){var o={datecreate:1};if(o.extras=e.APIHelper.request.getRebootPeopleExtras(),YUI.Env.isServer&&s.id===r.request.probableUser?(o.storage=1,o.extras+=", classic_user_id, timezone_dst, unified_search_view_pref, photostream_view_order_pref, photostream_view_as_pref, album_view_layout, download_pref, products_features, subscriptions",o.extras+=", is_minor"):r.getViewer().signedIn&&s.id===r.getViewer().nsid&&(o.extras+=", products_features, subscriptions"),s.extras&&"string"==typeof s.extras&&s.extras.length>0&&(o.extras=o.extras+","+s.extras),s.id)o.user_id=s.id;else{if(!s.pathAlias)throw new Error("`fetch` is missing required params.");o.path_alias=s.pathAlias}return s.storage&&(o.storage=s.storage),o.extras||(o.extras=""),o.extras+=", has_stats",o},_processResponse:function(s,t,i){var a,n,l,p=s.apiResponse,d=s.personModelRegistry,g=s.personRelationshipModelRegistry,c=s.personProfileModelRegistry,u=s.personPreferencesModelRegistry,m=s.personGroupsModelRegistry,h=s.personNotificationsModelRegistry,f=s.photostreamModelRegistry,M=p.person,_=i.getViewer(),y=M.id,R=_&&_.signedIn&&y===_.nsid;return l={id:y,pathAlias:M.pathAlias,username:M.username&&M.username._content,realname:M.realname&&M.realname._content,buddyicon:e.APIHelper.response.removeProtocolFromURL(M.iconurls),isAdFree:M.isAdFree,isPro:M.ispro,proBadge:M.proBadge,isMinor:M.isMinor,hasStats:M.hasStats,location:M.location&&M.location._content,hasAdfree:M.hasAdfree,has1TB:M.has1TB,has2TB:M.has2TB,hasUnlimitedStorage:M.hasUnlimitedStorage,hasFreeStandardShipping:M.hasFreeStandardShipping,hasFreeEducationalResources:M.hasFreeEducationalResources,dateCreated:M.datecreate._content,expiringPartner:M.expiringPartner},M.ispro&&(l.proExpireDate=M.expire),M.gift&&(l.isEligibleForGifts=M.gift.giftEligible||!1,l.eligibleGifts=M.gift.eligibleDurations||[],l.newFlow=M.gift.newFlow||!1),R&&(l.uploadLimit=M.uploadLimit,l.uploadCount=M.uploadCount,l.uploadLimitStatus=M.uploadLimitStatus,l.isCognitoUser=M.isCognitoUser,l.hasInvalidEmail=!1,M.email&&(!M.email||M.email._content&&""!==M.email._content)?M.email._content&&-1===M.email._content.indexOf("@")?l.hasInvalidEmail=!0:l.hasInvalidEmail=!1:l.hasInvalidEmail=!0,l.isPro&&(l.subscription=r.parseEffectiveSubscriptionData(!0,p.effectiveSubscriptions)),M.contactsCacheUrl&&(l.contactsCacheUrl=M.contactsCacheUrl),M.segments&&M.segments.length?(l.segments=M.segments,o.info("User belongs to these segments",l.segments)):o.info("User is not in any segment")),d.addOrUpdate(l),h.addOrUpdate({id:y,unreadFlickrMailCount:M.unreadMessages?M.unreadMessages.content:0}),g.addOrUpdate({id:y,pathAlias:M.pathAlias,isContact:M.contact,isFriend:M.friend,isFamily:M.family,isIgnored:M.ignored,isIgnoredBy:M.ignoredby,isRevContact:M.revcontact,isRevFriend:M.revfriend,isRevFamily:M.revfamily}),R&&(n={id:y},M.safeSearch&&(n.safeSearch=(M.safeSearch||1)-1),M.viewPrefs&&(n.unifiedSearchViewPref=M.viewPrefs.unifiedSearchViewPref,n.photostreamViewOrderPref=M.viewPrefs.photostreamViewOrderPref,n.photostreamViewAsPref=M.viewPrefs.photostreamViewAsPref,n.albumViewLayoutPref=M.viewPrefs.albumViewLayout,n.galleryViewLayoutPref=M.viewPrefs.galleriesViewLayoutPref),u.exists(y)?u.setValues(y,n):u.add(n)),a={id:y,coverPhotoUrls:e.APIHelper.response.removeProtocolFromURL(M.coverphoto_url),photoCount:M.photos.count.content,location:M.location?M.location.content:null,arrPhotoCount:M.all_rights_reserved_photos_count},M.storage&&(a.storageUsed=M.storage.used.content,a.storageTotal=M.storage.total.content),M.unreadMessages&&(a.unreadMessages=M.unreadMessages.content),c.addOrUpdate(a),m.addOrUpdate({id:y,memberCount:M.groupMemberships?M.groupMemberships.member:null,moderatorCount:M.groupMemberships?M.groupMemberships.moderator:null,adminCount:M.groupMemberships?M.groupMemberships.admin:null,invitedCount:M.groupMemberships?M.groupMemberships.invited:null}),f.addOrUpdate({id:y,pathAlias:M.pathAlias,owner:d.proxy(y),totalItems:M.photos.count&&M.photos.count.content}),M}}}),"@VERSION@",{requires:["flickr-promise","subscriptions-helper"],optionalRequires:["hermes-core"],optional:["person-models","person-relationship-models","person-preferences-models","person-profile-models","person-groups-models","photostream-models","api-helper"]});