YUI.add("hermes-template-sub-photo-contexts-albums",(function(t,e){var n=t.Template.Handlebars.revive({1:function(t,e,n,l,o){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"canAdd"):e,{name:"if",hash:{},fn:t.program(2,o,0),inverse:t.noop,data:o,loc:{start:{line:2,column:1},end:{line:7,column:8}}}))?a:""},2:function(t,e,n,l,o){var a=null!=e?e:t.nullContext||{},r=t.hooks.helperMissing,s=t.escapeExpression,i=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t<div class="sub-photo-context sub-photo-context-albums empty">\n\t\t\t<p tabindex="0">'+s((i(n,"intlMessage")||e&&i(e,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_NOT_IN_ALBUMS"},data:o,loc:{start:{line:4,column:19},end:{line:4,column:84}}}))+"</p>\n\t\t\t<p><a href='#' class='add-to'>"+s((i(n,"intlMessage")||e&&i(e,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_ALBUM"},data:o,loc:{start:{line:5,column:33},end:{line:5,column:91}}}))+"</a></p>\n\t\t</div>\n"},4:function(t,e,n,l,o){var a,r=null!=e?e:t.nullContext||{},s=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t<div class="sub-photo-context sub-photo-context-albums">\n'+(null!=(a=t.invokePartial(s(l,"sub-photo-contexts-title-albums"),e,{name:"sub-photo-contexts-title-albums",data:o,indent:"\t\t",helpers:n,partials:l,decorators:t.decorators}))?a:"")+(null!=(a=s(n,"if").call(r,null!=e?s(e,"canAdd"):e,{name:"if",hash:{},fn:t.program(5,o,0),inverse:t.noop,data:o,loc:{start:{line:11,column:2},end:{line:13,column:9}}}))?a:"")+'\t\t<ul class="context-list">\n'+(null!=(a=s(n,"each").call(r,null!=e?s(e,"contexts"):e,{name:"each",hash:{},fn:t.program(7,o,0),inverse:t.noop,data:o,loc:{start:{line:15,column:3},end:{line:17,column:12}}}))?a:"")+"\t\t</ul>\n"+(null!=(a=s(n,"if").call(r,null!=e?s(e,"showMore"):e,{name:"if",hash:{},fn:t.program(9,o,0),inverse:t.noop,data:o,loc:{start:{line:19,column:2},end:{line:21,column:9}}}))?a:"")+"\t</div>\n"},5:function(t,e,n,l,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return"\t\t\t<a href='#' class='add-to'>"+t.escapeExpression((a(n,"intlMessage")||e&&a(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_ALBUM"},data:o,loc:{start:{line:12,column:30},end:{line:12,column:88}}}))+"</a>\n"},7:function(t,e,n,l,o){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=t.invokePartial(r(l,"sub-photo-contexts-item"),e,{name:"sub-photo-contexts-item",data:o,indent:"\t\t\t\t",helpers:n,partials:l,decorators:t.decorators}))?a:""},9:function(t,e,n,l,o){var a=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return'\t\t\t<div class="view-all-contexts-of-type"><a href="#">'+t.escapeExpression((a(n,"intlMessage")||e&&a(e,"intlMessage")||t.hooks.helperMissing).call(null!=e?e:t.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.VIEW_MORE_ALBUMS"},data:o,loc:{start:{line:20,column:54},end:{line:20,column:116}}}))+"</a></div>\n"},compiler:[8,">= 4.3.0"],main:function(t,e,n,l,o){var a,r=t.lookupProperty||function(t,e){if(Object.prototype.hasOwnProperty.call(t,e))return t[e]};return null!=(a=r(n,"if").call(null!=e?e:t.nullContext||{},null!=e?r(e,"empty"):e,{name:"if",hash:{},fn:t.program(1,o,0),inverse:t.program(4,o,0),data:o,loc:{start:{line:1,column:0},end:{line:23,column:7}}}))?a:""},usePartial:!0,useData:!0}),l={};t.Array.each(["sub-photo-contexts-title-albums","sub-photo-contexts-item"],(function(e){var n=t.Template.get("hermes/"+e);n&&(l[e]=n)})),t.Template.register("hermes/sub-photo-contexts-albums",(function(e,o){return(o=o||{}).partials=o.partials?t.merge(l,o.partials):l,n(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-contexts-title-albums","hermes-template-sub-photo-contexts-item"]});YUI.add("set-selection-dialog-view",(function(e,t){var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("set-selection-dialog-view",e.Views["album-selection-dialog-view"],[],{langBundles:this.details.langBundles,initialLoad:function(){var t=this;return this.set("scrappy",this.appContext.flipper.isFlipped("enable-scrappy-photo-page")),this.setLabel=this.intlMessage({intlName:"photo-page-scrappy.ALBUM"}),this.setsLabel=this.intlMessage({intlName:"photo-page-scrappy.ALBUMS"}),this.set("page",1),this.set("perPage",this.appContext.flipper.isFlipped("enable-sets-list-loading-fix")?50:500),this.appContext.getModel("sets-models",{id:t.appContext.auth.user.nsid,page:t.get("page"),perPage:t.get("perPage")}).then((function(e){t.set("setsModel",e)})).then((function(){var s={setsList:t.get("setsModel").getValue("albumsList").getPage({page:t.get("page"),perPage:t.get("perPage")})};return t.get("isMultiplePhotos")?s.albumsSharedBetweenPhotos=t.appContext.callAPI("flickr.cameraroll.getPhotosMeta",{photo_ids:t.get("photoID"),properties:"albums"},!0):s.setsThePhotoIsIn=t.appContext.getModel("photo-sets-models",t.get("photoID")).then((function(e){return e.getListPageByContinuation(t.get("perPage")).then((function(){return e.getValue("sets").getList()}))})),new e.FlickrPromise(s).then((function(e){var o,s=e.setsList,r=e.setsThePhotoIsIn?e.setsThePhotoIsIn:[],n=[],i=[];for(t.get("isMultiplePhotos")&&e.albumsSharedBetweenPhotos.albums&&e.albumsSharedBetweenPhotos.albums.forEach((function(e){i.push({getValue:function(t){return e[t]}})})),o=0;o<s.length;o++)s[o].getValue("isAutoUploadSet")||n.push(s[o].toJSON());t.set("albumList",n),t.set("albumListForPhoto",t.get("isMultiplePhotos")?i:r),t.set("setsShowingCount",t.get("perPage")),t.recursivelyLoadMore()})).then(null,(function(e){throw o.error({err:e}),t.onError({message:t.intlMessage({intlName:"photo-page-scrappy.ERROR_LOADING_ALBUMS"}),err:e}),e}))}))},recursivelyLoadMore:function(){var e,t=this,o=this.get("setsShowingCount"),s=t.get("setsModel").getValue("totalItems");o<s&&s>0&&(t.appendLoader(),t.set("page",t.get("page")+1),this.get("setsModel").getValue("albumsList").getPage({page:t.get("page"),perPage:t.get("perPage")}).then((function(o){for(t.removeLoader(),e=0;e<o.length;e++)o[e]=o[e].toJSON();t.appendAlbums(o),t.set("setsShowingCount",t.get("setsShowingCount")+t.get("perPage")),t.recursivelyLoadMore()})).then(null,(function(e){throw t.removeLoader(),t.onError({message:t.intlMessage({intlName:"photo-page-scrappy.ERROR_LOADING_ALBUMS"}),err:e}),e})))},addPhoto:function(t){var o=this,s=this.get("multiplePhotosBatchSize"),r=[],n=0,i=[],a=[];if(this.get("isMultiplePhotos"))for(r=this.get("photoID").split(","),n=r.length;r.length>0;)i.push(r.splice(0,s));return this.appContext.getModelRegistry("set-models").then((function(s){return o.get("isMultiplePhotos")?(i.forEach((function(e,r){a.push((function(){return s.remote.addPhoto({photoID:e.join(","),isMultiplePhotos:!0,numberOfPhotosSelected:o._params.numberOfPhotosSelected,numberOfVideosSelected:o._params.numberOfVideosSelected,photosSelectedIds:o._params.photosSelectedIds,videosSelectedIds:o._params.videosSelectedIds,updateItemCounts:0===r,setID:t},o.appContext)}))})),a.reduce((function(e,t){return e.then(t)}),e.Promise.resolve()).then(null,(function(e){var t=n>1?"ERROR_ADDING_PHOTOS_TO_ALBUM":"ERROR_ADDING_PHOTO_TO_ALBUM";throw o.onError({message:o.intlMessage({intlName:"photo-page-scrappy."+t}),err:e}),e}))):s.remote.addPhoto({photoID:o.get("photoID"),isMultiplePhotos:o.get("isMultiplePhotos"),setID:t},o.appContext).then(null,(function(e){throw o.onError({message:o.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_PHOTO_TO_ALBUM"}),err:e}),e}))}))},removePhoto:function(t){var o,s=this,r=this.get("multiplePhotosBatchSize"),n=[],i=0,a=[],l=[];if(this.get("isMultiplePhotos"))for(n=this.get("photoID").split(","),i=n.length;n.length>0;)a.push(n.splice(0,r));return this.appContext.getModelRegistry("set-models").then((function(r){if(s.get("isMultiplePhotos")){for(o=0;o<a.length;o++)l.push(r.remote.removePhoto({photoID:a[o].join(","),isMultiplePhotos:!0,numberOfPhotosSelected:s._params.numberOfPhotosSelected,numberOfVideosSelected:s._params.numberOfVideosSelected,updateItemCounts:0===o,setID:t},s.appContext));return e.Promise.all(l).then(null,(function(e){var t=i>1?"ERROR_REMOVING_PHOTOS_FROM_ALBUM":"ERROR_REMOVING_PHOTO_FROM_ALBUM";throw s.onError({message:s.intlMessage({intlName:"photo-page-scrappy."+t}),err:e}),e}))}return r.remote.removePhoto({photoID:s.get("photoID"),setID:t},s.appContext).then(null,(function(e){throw s.onError({message:s.intlMessage({intlName:"photo-page-scrappy.ERROR_REMOVING_PHOTO_FROM_ALBUM"}),err:e}),e}))}))},createNewAndAddPhoto:function(t,s){var r=this;return this.appContext.getModelRegistry("set-models").then((function(n){return n.remote.create({photoID:r.get("photoID").split(",")[0],title:t,description:s,isMultiplePhotos:r.get("isMultiplePhotos"),numberOfPhotosSelected:r._params.numberOfPhotosSelected,numberOfVideosSelected:r._params.numberOfVideosSelected},r.appContext).then((function(t){var o=[],s=r.get("photoID").split(",");return r.get("isMultiplePhotos")&&(s=s.slice(1)).length>0&&o.push(r.addPhoto(t.getValue("id"))),e.Promise.all(o).then((function(){return t}))}),(function(e){throw r.onError({message:r.intlMessage({intlName:"photo-page-scrappy.ERROR_CREATING_ALBUM"}),err:e}),e})).catch((function(e){o.error("Error handing photo addition after album creation",{err:e})}))}))},onError:function(e){this.fire("error",e);var t=document.querySelector(".album-selection-errors"),o=document.querySelector(".album-selection-buttons");document.querySelector(".error-message").innerText=e.message,o.classList.add("hide"),t.classList.remove("hide")}})}),"@VERSION@",{requires:["flickr-view","album-selection-dialog-view"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["common","groups","photo-page-scrappy"]});YUI.add("sub-photo-albums-view",(function(t,e){var o=require("hermes-core/flog")(e);t.FlickrView.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){this.photoId=t.photoId,this.list=[],this.loading=!1,this.removing={},this.startAmount=6,this.perPage=50,this.displayAmount=this.startAmount,this.addKeyShortcut="down:65,69",void 0!==this.getViewDataFromHistory("displayAmount")&&(this.startAmount=this.getViewDataFromHistory("displayAmount"),this.displayAmount=this.getViewDataFromHistory("displayAmount")),""===this.get("container").get("innerHTML")&&this.setContainerHTML("")},loadState:function(){var e,o=this;return e={photoSetsModel:this.appContext.getModel("photo-sets-models",this.photoId),photoModel:this.appContext.getModel("photo-models",this.photoId)},this.appContext.getViewer().signedIn&&this.appContext.getViewer().nsid===this._params.nsid&&(e.personSetsModel=this.appContext.getModel("sets-models",this.appContext.getViewer().nsid,{page:1,perPage:this.appContext.flipper.isFlipped("enable-sets-list-loading-fix")?10:500})),new t.FlickrPromise(e).then((function(e){return t.Object.each(e,(function(t,e){o.set(e,t)})),o.loadListData()}))},loadListData:function(){var e=this;return this.loading=!0,this.getSets(this.displayAmount).then((function(o){var i,s,n,a,r=e.list,l=[];return e.loading=!1,(l=o||[]).length>e.displayAmount&&(l=l.slice(0,e.displayAmount)),(s=r)===(n=l)||s.length===n.length&&(a=!0,t.Array.some(s,(function(t,e){if(t!==n[e])return a=!1,!0})),a)?i=!1:(e.list=l,i=!0),{listChanged:i}}))},getSets:function(e){var o=this.get("photoSetsModel"),i=o.getValue("sets").getList(),s=o.getValue("total");return e>s&&(e=s),i.length<e?o.getListPageByContinuation(e-i.length).then((function(){return o.getValue("sets").getList().slice(0,e)})):t.Promise.resolve(i.slice(0,e))},canViewerRemove:function(t){return this.appContext.getViewer().nsid===this._params.nsid},canViewerAdd:function(){return this.appContext.getViewer().nsid===this._params.nsid},listToJSON:function(){var t=this;return this.list.map((function(e){var o=e.toJSON();return o.isSet=!0,o.canRemove=t.canViewerRemove(e),o}))},buildContainer:function(){var e=this.get("photoSetsModel").getValue("total"),o=e>this.displayAmount;this.setContainerWithTemplate("sub-photo-contexts-albums",{empty:0===this.list.length,canAdd:this.canViewerAdd(),contexts:this.listToJSON(),showMore:o,total:e,totalFriendly:t.Number.format(e,{thousandsSeparator:","})})},activate:function(){var t=this,e=this.get("container");return this.canViewerAdd()&&(this.get("photoSetsModel")&&this.registerEventHandler(this.get("photoSetsModel").on("valuesChanged",this.handleListChanges.bind(this))),this.attachKeyEvent(this.addKeyShortcut,(function(e){e.preventDefault(),t.showAddDialog()}))),this.registerEventHandler(e.on("click",this.handleContainerClick.bind(this))),this},handleListChanges:function(t){this.loading||this.reload()},handleContainerClick:function(t){var e,i,s=this;t.target.ancestor(".remove",!0)?(t.preventDefault(),e=t.target.ancestor("li"),i=e.getAttribute("data-context-id"),this.appContext.getModel("set-models",i).then((function(t){1===t.getValue("photoCount")+t.getValue("videoCount")?s.confirmDeleteAlbum(t).then((function(){s.removeFromContext(i,e)}),(function(t){o.error("error opening the album deletion warning modal",{err:t})})):s.removeFromContext(i,e)}))):t.target.ancestor(".add-to",!0)?(t.preventDefault(),this.showAddDialog()):t.target.ancestor(".view-all-contexts-of-type a",!0)&&(t.preventDefault(),this.showMore())},showMore:function(){this.displayAmount===this.startAmount&&this.startAmount<this.perPage?this.displayAmount=this.perPage:this.displayAmount+=this.perPage,this.setViewDataOnHistory("displayAmount",this.displayAmount),this.reload()},reload:function(){var t=this;this.loadListData().then((function(e){e.listChanged&&t.buildContainer()}))},removeFromContext:function(t,e){var o=this,i={photoID:this.photoId,setID:t};this.removing[t]||(this.removing[t]=!0,e.setStyle("opacity","0"),"set-models","removePhoto",this.get("photoSetsModel"),this.appContext.getModelRegistry("set-models").then((function(s){s.remote.removePhoto(i,o.appContext).then((function(e){delete o.removing[t],o.reload()}),(function(i){throw delete o.removing[t],e.setStyle("opacity","1"),i})).then(null,(function(t){throw o.onError({message:this.intlMessage({intlName:"photo-page-scrappy.ERROR_REMOVING_FROM_ALBUM"}),err:t}),t}))})))},confirmDeleteAlbum:function(e){var o=this;return new t.Promise((function(e,i){var s;(s=new t.Views.FluidModal({title:o.intlMessage({intlName:"common.CONFIRMATION"}),actionButtonLabel:o.intlMessage({intlName:"photo-page-scrappy.REMOVE_PHOTO_AND_ALBUM"}),htmlMessage:o.intlMessage({intlName:"photo-page-scrappy.WARNING_REMOVE_LAST_PHOTO_FROM_ALBUM"}),appContext:o.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0})).on("actionClick",(function(t){e(),o.appContext.flapp.get("activeView").backToURL="",o.appContext.flapp.navigate(o.get("photoModel").getValue("url"))})),s.on("cancelClick",(function(t){i()})),s.show()}))},showAddDialog:function(){this.showAddToStuff()},showAddToStuff:function(){new t.CurationHelper(this.appContext).showAddToCuration({photoId:this.photoId,showAlbums:!0,showGalleries:!1,initialTab:"album",useViewportType:!1,containerType:"modal"})},onError:function(e){new t.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:e.message,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),classList:"scrappy-dialog",showCancelButton:!1,showActionButton:!1,showFooter:!1,dismissOnOverlayClick:!0}).show()}})}),"@VERSION@",{requires:["array-extras","flickr-view","flickr-promise","hermes-template-sub-photo-contexts-item","hermes-template-sub-photo-contexts-title-albums","hermes-template-sub-photo-contexts-albums","url-helper","set-selection-dialog-view","fluid-modal-view","add-to-stuff-view","curation-helper"],optionalRequires:["hermes-core"],optional:["photo-sets-models","photo-models","sets-models"],langBundles:["more-menu-view","groups","photo-page-scrappy","common"]});YUI.add("hermes-template-sub-photo-contexts-title-galleries",(function(n,e){var l=n.Template.Handlebars.revive({1:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"!==",0,{name:"ifCond",hash:{},fn:n.program(2,o,0),inverse:n.noop,data:o,loc:{start:{line:3,column:2},end:{line:5,column:13}}}))?a:"")+(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:6,column:2},end:{line:8,column:13}}}))?a:"")},2:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalFriendly"):e,intlName:"photo-page-scrappy.GALLERIES_COUNT"},data:o,loc:{start:{line:4,column:3},end:{line:4,column:84}}}))+"\n"},4:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.GALLERIES"},data:o,loc:{start:{line:7,column:3},end:{line:7,column:46}}}))+"\n"},6:function(n,e,l,t,o){var a,r=null!=e?e:n.nullContext||{},i=n.hooks.helperMissing,s=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"===",1,{name:"ifCond",hash:{},fn:n.program(7,o,0),inverse:n.noop,data:o,loc:{start:{line:10,column:2},end:{line:12,column:13}}}))?a:"")+(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,">",1,{name:"ifCond",hash:{},fn:n.program(9,o,0),inverse:n.noop,data:o,loc:{start:{line:13,column:2},end:{line:15,column:13}}}))?a:"")+(null!=(a=(s(l,"ifCond")||e&&s(e,"ifCond")||i).call(r,null!=e?s(e,"total"):e,"===",0,{name:"ifCond",hash:{},fn:n.program(4,o,0),inverse:n.noop,data:o,loc:{start:{line:16,column:2},end:{line:18,column:13}}}))?a:"")},7:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_IN_ONE_GALLERY"},data:o,loc:{start:{line:11,column:3},end:{line:11,column:69}}}))+"\n"},9:function(n,e,l,t,o){var a=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return"\t\t\t"+n.escapeExpression((a(l,"intlMessage")||e&&a(e,"intlMessage")||n.hooks.helperMissing).call(null!=e?e:n.nullContext||{},{name:"intlMessage",hash:{count:null!=e?a(e,"totalFriendly"):e,intlName:"photo-page-scrappy.PHOTO_IN_N_GALLERIES"},data:o,loc:{start:{line:14,column:3},end:{line:14,column:89}}}))+"\n"},compiler:[8,">= 4.3.0"],main:function(n,e,l,t,o){var a,r=n.lookupProperty||function(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]};return'<h5 class="total">\n'+(null!=(a=r(l,"if").call(null!=e?e:n.nullContext||{},null!=e?r(e,"isMobile"):e,{name:"if",hash:{},fn:n.program(1,o,0),inverse:n.program(6,o,0),data:o,loc:{start:{line:2,column:1},end:{line:19,column:8}}}))?a:"")+"</h5>"},useData:!0}),t={};n.Array.each([],(function(e){var l=n.Template.get("hermes/"+e);l&&(t[e]=l)})),n.Template.register("hermes/sub-photo-contexts-title-galleries",(function(e,o){return(o=o||{}).partials=o.partials?n.merge(t,o.partials):t,l(e,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-contexts-galleries",(function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,l,o){var a,r=null!=t?t:e.nullContext||{},s=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t<div class="sub-photo-context sub-photo-context-galleries">\n'+(null!=(a=e.invokePartial(s(l,"sub-photo-contexts-title-galleries"),t,{name:"sub-photo-contexts-title-galleries",data:o,indent:"\t\t",helpers:n,partials:l,decorators:e.decorators}))?a:"")+"\n"+(null!=(a=s(n,"if").call(r,null!=t?s(t,"canAdd"):t,{name:"if",hash:{},fn:e.program(2,o,0),inverse:e.noop,data:o,loc:{start:{line:22,column:2},end:{line:24,column:9}}}))?a:"")+"\n"+(null!=(a=(s(n,"isFlipped")||t&&s(t,"isFlipped")||e.hooks.helperMissing).call(r,"enable-likes",{name:"isFlipped",hash:{},fn:e.program(4,o,0),inverse:e.noop,data:o,loc:{start:{line:26,column:2},end:{line:32,column:16}}}))?a:"")+'\n\t\t<ul class="context-list">\n'+(null!=(a=s(n,"each").call(r,null!=t?s(t,"contexts"):t,{name:"each",hash:{},fn:e.program(7,o,0),inverse:e.noop,data:o,loc:{start:{line:35,column:3},end:{line:37,column:12}}}))?a:"")+"\t\t</ul>\n"+(null!=(a=s(n,"if").call(r,null!=t?s(t,"showMore"):t,{name:"if",hash:{},fn:e.program(9,o,0),inverse:e.noop,data:o,loc:{start:{line:39,column:2},end:{line:41,column:9}}}))?a:"")+"\t</div>\n"},2:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return"\t\t\t<a href='#' class='add-to'>"+e.escapeExpression((a(n,"intlMessage")||t&&a(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GALLERY"},data:o,loc:{start:{line:23,column:30},end:{line:23,column:90}}}))+"</a>\n"},4:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=(r(n,"ifCond")||t&&r(t,"ifCond")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?r(t,"faveCount"):t,">",0,{name:"ifCond",hash:{},fn:e.program(5,o,0),inverse:e.noop,data:o,loc:{start:{line:27,column:3},end:{line:31,column:14}}}))?a:""},5:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t\t<div class="faves-container">\n\t\t\t\t\t'+e.escapeExpression((a(n,"outlet")||t&&a(t,"outlet")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},null!=t?a(t,"sub-photo-fave-view"):t,{name:"outlet",hash:{},data:o,loc:{start:{line:29,column:5},end:{line:29,column:35}}}))+"\n\t\t\t\t</div>\n"},7:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=e.invokePartial(r(l,"sub-photo-contexts-item"),t,{name:"sub-photo-contexts-item",data:o,indent:"\t\t\t\t",helpers:n,partials:l,decorators:e.decorators}))?a:""},9:function(e,t,n,l,o){var a=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t\t<div class="view-all-contexts-of-type"><a href="#">'+e.escapeExpression((a(n,"intlMessage")||t&&a(t,"intlMessage")||e.hooks.helperMissing).call(null!=t?t:e.nullContext||{},{name:"intlMessage",hash:{intlName:"photo-page-scrappy.VIEW_MORE_GALLERIES"},data:o,loc:{start:{line:40,column:54},end:{line:40,column:119}}}))+"</a></div>\n"},11:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return null!=(a=r(n,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"canAdd"):t,{name:"if",hash:{},fn:e.program(12,o,0),inverse:e.noop,data:o,loc:{start:{line:6,column:1},end:{line:11,column:8}}}))?a:""},12:function(e,t,n,l,o){var a=null!=t?t:e.nullContext||{},r=e.hooks.helperMissing,s=e.escapeExpression,i=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return'\t\t<div class="sub-photo-context sub-photo-context-galleries empty">\n\t\t\t<p tabindex="0">'+s((i(n,"intlMessage")||t&&i(t,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PHOTO_NOT_IN_GALLERIES"},data:o,loc:{start:{line:8,column:19},end:{line:8,column:87}}}))+"</p>\n\t\t\t<p><a href='#' class='add-to'>"+s((i(n,"intlMessage")||t&&i(t,"intlMessage")||r).call(a,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_TO_GALLERY"},data:o,loc:{start:{line:9,column:33},end:{line:9,column:93}}}))+"</a></p>\n\t\t</div>\n"},compiler:[8,">= 4.3.0"],main:function(e,t,n,l,o){var a,r=e.lookupProperty||function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]};return(null!=(a=r(n,"if").call(null!=t?t:e.nullContext||{},null!=t?r(t,"hasFavesOrGalleries"):t,{name:"if",hash:{},fn:e.program(1,o,0),inverse:e.program(11,o,0),data:o,loc:{start:{line:1,column:0},end:{line:43,column:7}}}))?a:"")+"\n"},usePartial:!0,useData:!0}),l={};e.Array.each(["sub-photo-contexts-title-galleries","sub-photo-contexts-item"],(function(t){var n=e.Template.get("hermes/"+t);n&&(l[t]=n)})),e.Template.register("hermes/sub-photo-contexts-galleries",(function(t,o){return(o=o||{}).partials=o.partials?e.merge(l,o.partials):l,n(t,o)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-contexts-title-galleries","hermes-template-sub-photo-contexts-item"]});YUI.add("gallery-selection-dialog-view",(function(e,t){var o=require("hermes-core/flog")(t);e.namespace("Views")[this.name]=e.Base.create("gallery-selection-dialog-view",e.Views["album-selection-dialog-view"],[],{langBundles:this.details.langBundles,initialLoad:function(){var t,o=this;return this.set("scrappy",this.appContext.flipper.isFlipped("enable-scrappy-photo-page")),t={galleriesModel:this.appContext.getModel("person-galleries-models",this.appContext.auth.user.nsid)},this.get("scrappy")?t.galleriesThePhotoIsIn=o.appContext.getModel("photo-galleries-models",o.get("photoID")).then((function(e){return e.getListPageByContinuation(400).then((function(){return e.getValue("galleries").getList()}))})):t.galleriesThePhotoIsIn=o.appContext.getModel("photo-contexts-models",o.get("photoID")).then((function(e){return e.registry.getContextsOfType(o.get("photoID"),"gallery-models")})),new e.FlickrPromise(t).then((function(e){e.galleriesModel;return o.set("galleriesList",e.galleriesModel.getValue("galleriesList")),o.set("albumListForPhoto",e.galleriesThePhotoIsIn),o.recursivelyLoadRemainingGalleries(1)})).then((function(){o.set("albumList",o.get("galleriesList").toJSON())}),(function(e){throw o.onError({message:o.intlMessage({intlName:"photo-page-scrappy.ERROR_LOADING_GALLERIES"}),err:e}),e}))},addPhoto:function(e){var t=this;return this.appContext.getModelRegistry("gallery-models").then((function(o){return o.remote.addPhoto({photoID:t.get("photoID"),galleryCompoundID:e},t.appContext).then(null,(function(e){throw t.onError({message:t.intlMessage({intlName:"photo-page-scrappy.ERROR_ADDING_TO_GALLERY"}),err:e}),e}))}))},removePhoto:function(e){var t=this;return this.appContext.getModelRegistry("gallery-models").then((function(o){return o.remote.removePhoto({photoID:t.get("photoID"),galleryCompoundID:e},t.appContext).then((function(e){return e}),(function(e){throw t.onError({message:t.intlMessage({intlName:"photo-page-scrappy.ERROR_REMOVING_FROM_GALLERY"}),err:e}),e}))}))},createNewAndAddPhoto:function(e,t){var o=this;return this.appContext.getModelRegistry("gallery-models").then((function(r){return r.remote.create({photoID:o.get("photoID"),title:e,description:t},o.appContext).then((function(e){return e.getValue("primary")||o.onError({message:o.intlMessage({intlName:"photo-page-scrappy.ERROR_PHOTO_NOT_ALLOWED_IN_GALLERY"}),err:{message:"Photo cannot be added to galleries.",stack:"gallery-selection-dialog"}}),e}),(function(e){throw o.onError({message:o.intlMessage({intlName:"photo-page-scrappy.ERROR_CREATING_GALLERY"}),err:e}),e}))}))},onError:function(e){var t=document.querySelector(".album-selection-errors"),r=document.querySelector(".album-selection-buttons");document.querySelector(".error-message").innerText=e.message,r.classList.add("hide"),t.classList.remove("hide"),o.error({err:e.err})},recursivelyLoadRemainingGalleries:function(t){var o=this;return o.get("galleriesList").getList().length<o.get("galleriesList").totalItems?this.get("galleriesList").getPage({page:t,perPage:500}).then((function(){return o.recursivelyLoadRemainingGalleries(t+1)})):e.Promise.resolve()}})}),"@VERSION@",{requires:["flickr-view","album-selection-dialog-view"],optionalRequires:["hermes-core"],optional:["set-models"],langBundles:["common","groups","photo-page-scrappy"]});